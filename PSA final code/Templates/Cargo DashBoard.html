<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
	<link rel="stylesheet" href="{{ url_for('static', filename='css/Cargo DashBoard.css') }}">
	<title>AdminSite</title>
</head>
<body>
	<div class="container">
		<!-- SIDEBAR -->
		<section id="sidebar">
			<a href="#" class="brand"><i class='bx bxs-smile icon'></i> PackTrack</a>
			<ul class="side-menu">
				<li><a href="/Cargo_DashBoard"class="active" ><i class='bx bxs-dashboard icon' ></i> Dashboard</a></li>
				<li class="divider" data-text="Booking">Main</li>
				
				
				<li><a href="/Cargo_Booking" ><i class='bx bxs-chart icon' ></i> Booking</a></li>
				<li><a href="/Cargo Info" ><i class='bx bxs-widget icon' ></i> Cargo Info</a></li>
				<li><a href="/Cargo Disputes" ><i class='bx bxs-widget icon' ></i> Disputes</a></li>
				
			</ul>
		</section>
		<!-- SIDEBAR -->

		<!-- NAVBAR -->
		<section id="content">
			<!-- NAVBAR -->
			<nav>
				<i class='bx bx-menu toggle-sidebar' ></i>
				<form action="#">
					<div class="form-group">
						<input type="text" placeholder="Search...">
						
					</div>
				</form>
				<a href="#" class="nav-link">
					<i class='bx bxs-bell icon'></i>
					<span class="badge">5</span>
					<div class="popup">
						<ul class="notification-list">
							<li>You have a new message.</li>
							<li>Your order was shipped.</li>
							<li>John commented on your post.</li>
							<li>Reminder: Meeting at 3 PM.</li>
							<li>System update available.</li>
						</ul>
					</div>
				</a>
				<span class="divider"></span>
				<div class="profile">
					<img src="https://images.unsplash.com/photo-1517841905240-472988babdf9?ixid=MnwxMjA3fDB8MHxzZWFyY2h8NHx8cGVvcGxlfGVufDB8fDB8fA%3D%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="">
					<ul class="profile-link">
						<li><a href="#"><i class='bx bxs-cog'></i> Settings</a></li>
						<li><a href="{{ url_for('logout') }}"><i class='bx bxs-log-out-circle'></i> Logout</a></li> 
					</ul>
				</div>
			</nav>
			<!-- NAVBAR -->

			<!-- MAIN -->
			<main>
				<h1 class="title">Dashboard</h1>
				<ul class="breadcrumbs">
					<li><a href="#">Home</a></li>
					<li class="divider">/</li>
					<li><a href="#" class="active">Dashboard</a></li>
				</ul>
				<div class="info-data">
					<div class="card">
						<div class="word">
							<div>
								<h2 id="ecoCreditPoints">0 Points</h2> <!-- Dynamic Eco Credit Points -->
								<p>Eco Credit Points</p>
							</div>
						</div>
						<span class="progress" id="pointsProgress" data-value="0%"></span>
						<span class="label" id="pointsLabel">0%</span>
					</div>
				
					<div class="card">
						<div class="word">
							<div>
								<h2 id="emissionsSaved">0 MT</h2> <!-- Dynamic CO₂ Emissions Saved -->
								<p>CO₂ Emissions Saved</p>
							</div>
						</div>
						<span class="progress" id="emissionsProgress" data-value="0%"></span>
						<span class="label" id="emissionsLabel">0%</span>
					</div>
				</div>
				
				<div class="data">
					<div class="content-data">
						<div class="head">
							<h3>Sales Report</h3>
							<div class="menu">
								<i class='bx bx-dots-horizontal-rounded icon'></i>
								<ul class="menu-link">
									<li><a href="#">Edit</a></li>
									<li><a href="#">Save</a></li>
									<li><a href="#">Remove</a></li>
								</ul>
							</div>
						</div>
						<div class="chart">
							<div id="chart"></div> <!-- Chart Container -->
						</div>
					</div>
					<div class="content-data">
						<div class="head">
							<h3>Chatbox</h3>
							<div class="menu">
								<i class='bx bx-dots-horizontal-rounded icon'></i>
								<ul class="menu-link">
									<li><a href="#">Edit</a></li>
									<li><a href="#">Save</a></li>
									<li><a href="#">Remove</a></li>
								</ul>
							</div>
						</div>
						<div class="chat-box">
							<p class="day"><span>Today</span></p>
							<div class="msg">
								<img src="https://images.unsplash.com/photo-1517841905240-472988babdf9?ixid=MnwxMjA3fDB8MHxzZWFyY2h8NHx8cGVvcGxlfGVufDB8fDB8fA%3D%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="">
								<div class="chat">
									<div class="profile">
										<span class="username">Alan</span>
										<span class="time">18:30</span>
									</div>
									<p>Hello</p>
								</div>
							</div>
							<div class="msg me">
								<div class="chat">
									<div class="profile">
										<span class="time">18:30</span>
									</div>
									<p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eaque voluptatum eos quam dolores eligendi exercitationem animi nobis reprehenderit laborum! Nulla.</p>
								</div>
							</div>
							<div class="msg me">
								<div class="chat">
									<div class="profile">
										<span class="time">18:30</span>
									</div>
									<p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Ipsam, architecto!</p>
								</div>
							</div>
							<div class="msg me">
								<div class="chat">
									<div class="profile">
										<span class="time">18:30</span>
									</div>
									<p>Lorem ipsum, dolor sit amet.</p>
								</div>
							</div>
						</div>
						<form action="#">
							<div class="form-group">
								<input type="text" placeholder="Type...">
								<button type="submit" class="btn-send"><i class='bx bxs-send' ></i></button>
							</div>
						</form>
					</div>
				</div>
				
			</main>
			<!-- MAIN -->
		</section>
		<!-- NAVBAR -->
	</div>
	<script>
		document.addEventListener('DOMContentLoaded', () => {
			fetch('/user-sustainability-comparison')
				.then(response => {
					if (!response.ok) {
						throw new Error('Network response was not ok ' + response.statusText);
					}
					return response.json();
				})
				.then(data => {
					console.log("Received Data:", data); // Debugging response

					// Calculate Eco Credit Points using a random formula (e.g., emissions saved multiplied by a random factor)
					const randomFactor = (Math.random() * (2 - 1.1) + 1.1).toFixed(2); // Random factor between 1.1 and 2
					const ecoCreditPoints = Math.round(data.emissions_saved * randomFactor + 50); // Add bonus points

					// Update Eco Credit Points and Emissions Saved
					document.getElementById('ecoCreditPoints').textContent = `${ecoCreditPoints} Points`;
					document.getElementById('emissionsSaved').textContent = `${data.emissions_saved.toFixed(2)} MT`;

					// Update Progress Bars (Optional if needed)
					const pointsPercentage = Math.min(100, ecoCreditPoints / 100); // Limit to 100% max
					document.getElementById('pointsProgress').setAttribute('data-value', `${pointsPercentage}%`);
					document.getElementById('pointsLabel').textContent = `${pointsPercentage}%`;

					const emissionsPercentage = data.savings_percentage.toFixed(2);
					document.getElementById('emissionsProgress').setAttribute('data-value', `${emissionsPercentage}%`);
					document.getElementById('emissionsLabel').textContent = `${emissionsPercentage}%`;

					// Render Chart with Baseline vs Optimized Emissions
					const dates = data.x.map(dateString => new Date(dateString).toISOString());
					const baselineData = data.baseline.map(value => Math.round(value || 0));
					const optimizedData = data.optimized.map(value => Math.round(value || 0));

					const options = {
						series: [
							{ name: 'Baseline Emissions (kg CO₂)', data: baselineData },
							{ name: 'Optimized Emissions (kg CO₂)', data: optimizedData }
						],
						chart: {
							height: 350,
							type: 'area'
						},
						dataLabels: { enabled: false },
						stroke: { curve: 'smooth' },
						xaxis: { type: 'datetime', categories: dates },
						tooltip: { x: { format: 'dd/MM/yy HH:mm' } },
						colors: ['#FF4560', '#00E396']
					};

					const chart = new ApexCharts(document.querySelector("#chart"), options);
					chart.render();
				})
				.catch(error => {
					console.error("Error fetching or processing data:", error);
				});
		});

	</script>
	<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
	<script src="{{ url_for('static', filename='js/Cargo DashBoard.js') }}"></script>
</body>
</html>